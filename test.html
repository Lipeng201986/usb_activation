<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Nreal HID Test</title>

</head>

<body>

    <label>test</label><br>
    <button id='connect'>connect</button>
    <button id='activate'>Activate glasses</button>
    <button id='deactivate'>Deactivate glasses</button>
    <button id='firmware'>firmware</button>
    <br>


    <label>output</label><br>
    <textarea id="output" cols="100" rows="5"></textarea>
    <script type="module">

        import Glasses from "/js/glasses.js"
        import * as Manager from '/js/manager.js';


        const hidFilters = [
            { 'vendorId': 0x3318 },
        ];
        window.onload = async () => {


            if (!Manager.hidSupported()) {
                return;
            }
            Manager.checkConnection();
            Manager.addHidListener();
            document.getElementById('connect').onclick = connectDevice;
            document.getElementById('activate').onclick = activate;
            document.getElementById('deactivate').onclick = deactivate;
            document.getElementById('firmware').onclick = firmware;
        }



        function firmware() {
            connectDevice().then((glasses) => {
                if (glasses) {
                    glasses.getFirmwareVersion().then((version) => {
                        setOutput('firmware : ' + version);
                    });
                }
            });
        }
        function deactivate() {
            connectDevice().then((glasses) => {
                if (glasses) {
                    glasses.deactivate().then((result) => {
                        setOutput('deactivate ' + result);
                    });
                }
            });
        }
        function activate() {
            connectDevice().then((glasses) => {
                if (glasses) {
                    glasses.activate().then((result) => {
                        setOutput('activate ' + result);
                    });
                }
            });
        }

        async function connectDevice() {
            let glasses = await Manager.checkConnection();
            if (glasses == undefined) {
                glasses = await Manager.requestDevice();
            }
            return glasses;
        }

        function setOutput(output) {
            document.getElementById('output').value = output;
        }
    </script>


</body>

</html>